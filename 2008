```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The 2008 Financial Crisis: A Structural Autopsy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #FDFCF8; /* Warm Neutral Background */
            color: #44403C; /* Stone 700 */
        }
        h1, h2, h3, h4, h5 {
            font-family: 'Merriweather', serif;
        }
        
        /* Chart Container Styling - MANDATORY */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Tailwind max-w-xl approx */
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        /* Flowchart Arrow Styling (No SVG) */
        .arrow-right {
            display: inline-block;
            width: 0; 
            height: 0; 
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 12px solid #78716C; /* Stone 500 */
        }
        .arrow-down {
            display: inline-block;
            width: 0; 
            height: 0; 
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 12px solid #78716C;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F5F5F4; 
        }
        ::-webkit-scrollbar-thumb {
            background: #A8A29E; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #78716C; 
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>

    <!-- Chosen Palette: Warm Intellectual (Warm Neutrals & Academic Blue) -->
    <!-- Application Structure Plan: 
         The app is designed as a vertical "scrollytelling" experience, mirroring a university lecture structure but interactive.
         1. Hero Section: Sets the stage with the core question about Trust.
         2. The Spark (Incentives): Interactive Chart.js showing the divergence of volume vs. quality. User toggles the quality line to "see" the risk.
         3. The Fuel (Securitization): A CSS-Grid based interactive diagram. Users click nodes to see the "Incentive Structure" at each step.
         4. The Mechanism (Leverage): A Calculator/Chart hybrid. User adjusts a slider for "Asset Drop %" to see how 33:1 leverage destroys equity instantly.
         5. The Explosion (Contagion): Plotly.js chart showing the correlation between US Housing and EU Banks.
         6. The Stress Test (Conclusion): A decision-making module (Bailout vs Let Fail) with feedback.
         
         Why this structure? It moves from the Micro (Broker incentives) to the Macro (Global Contagion), keeping the user engaged with specific "try it yourself" moments (slider, toggle, decision) rather than passive reading.
    -->

    <!-- Visualization & Content Choices:
         1. Incentive Chart: Goal -> Compare. Viz -> Mixed Bar/Line (Chart.js). Interaction -> Toggle Dataset. Justification -> Best way to show correlation divergence.
         2. Securitization Chain: Goal -> Organize/Process. Viz -> Styled HTML/CSS Boxes (No SVG). Interaction -> Click for Details. Justification -> Explains the "Hot Potato" complex flow simply.
         3. Leverage Simulator: Goal -> Inform/Change. Viz -> Stacked Bar (Chart.js) updated by Slider. Justification -> Leverage is abstract math; visualizing the "Equity" bar shrinking to zero makes it concrete.
         4. Contagion Map: Goal -> Relationships. Viz -> Plotly Line Chart. Justification -> Shows time-series correlation clearly.
         Confirming NO SVG graphics used. NO Mermaid JS used.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="antialiased">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-[#FDFCF8]/95 backdrop-blur-sm border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-stone-800 font-serif">LSE Economics: Crisis '08</span>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#incentives" class="text-stone-600 hover:text-stone-900 text-sm font-medium">Incentives</a>
                    <a href="#securitization" class="text-stone-600 hover:text-stone-900 text-sm font-medium">Securitization</a>
                    <a href="#leverage" class="text-stone-600 hover:text-stone-900 text-sm font-medium">Leverage</a>
                    <a href="#contagion" class="text-stone-600 hover:text-stone-900 text-sm font-medium">Contagion</a>
                    <a href="#stresstest" class="px-4 py-2 rounded-md bg-stone-800 text-white text-sm font-medium hover:bg-stone-700">Stress Test</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-stone-100 overflow-hidden">
        <div class="max-w-7xl mx-auto">
            <div class="relative z-10 pb-8 bg-stone-100 sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32">
                <main class="mt-10 mx-auto max-w-7xl px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28">
                    <div class="sm:text-center lg:text-left">
                        <h1 class="text-4xl tracking-tight font-extrabold text-stone-900 sm:text-5xl md:text-6xl">
                            <span class="block xl:inline">The Anatomy of</span>
                            <span class="block text-indigo-700">Systemic Failure</span>
                        </h1>
                        <p class="mt-3 text-base text-stone-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-auto">
                            Why do you trust a bank with your money? The 2008 Crisis wasn't just a math error. It was a failure of <strong>Incentives</strong>, <strong>Risk Assessment</strong>, and <strong>Trust</strong>.
                        </p>
                        <div class="mt-5 sm:mt-8 sm:flex sm:justify-center lg:justify-start">
                            <div class="rounded-md shadow">
                                <a href="#incentives" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-700 hover:bg-indigo-800 md:py-4 md:text-lg">
                                    Start the Autopsy
                                </a>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2 bg-indigo-50 flex items-center justify-center">
            <div class="text-center p-8">
                <div class="text-6xl font-serif text-indigo-200 mb-4">"Trust"</div>
                <div class="text-stone-400">is the currency of the realm.</div>
            </div>
        </div>
    </header>

    <!-- SECTION 1: INCENTIVES -->
    <section id="incentives" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="lg:text-center mb-12">
                <h2 class="text-base text-indigo-600 font-semibold tracking-wide uppercase">First Principles</h2>
                <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl">
                    The Spark: Misaligned Incentives
                </p>
                <p class="mt-4 max-w-2xl text-xl text-stone-500 lg:mx-auto">
                    In the early 2000s, mortgage brokers were paid on <strong>volume</strong>, not quality. When you separate the risk from the reward, you get a "Quantity over Quality" disaster.
                </p>
            </div>

            <div class="mt-10 lg:grid lg:grid-cols-2 lg:gap-8 items-center">
                <div class="mb-8 lg:mb-0">
                    <div class="bg-stone-50 p-6 rounded-lg shadow-sm border border-stone-200">
                        <h3 class="text-lg font-bold text-stone-800 mb-4">Loan Volume vs. Quality Standards</h3>
                        <div class="chart-container">
                            <canvas id="incentiveChart"></canvas>
                        </div>
                        <div class="mt-4 text-center">
                            <button id="toggleQualityBtn" class="px-4 py-2 bg-stone-200 hover:bg-stone-300 rounded text-stone-700 text-sm font-semibold transition">
                                Toggle "Quality Check" Line
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="prose prose-stone text-stone-500">
                        <p>
                            Observe the chart. As the volume of Subprime Loans (Blue Bars) skyrocketed between 2001 and 2006, something critical happened to the documentation standards (Red Line).
                        </p>
                        <ul class="list-disc pl-5 space-y-2 mt-4">
                            <li><strong>2001:</strong> Most borrowers had to prove income.</li>
                            <li><strong>2006:</strong> "NINJA" loans became common (No Income, No Job, No Assets).</li>
                        </ul>
                        <div class="mt-6 bg-amber-50 border-l-4 border-amber-400 p-4">
                            <p class="text-sm text-amber-800 font-bold">
                                Professor's Note:
                            </p>
                            <p class="text-sm text-amber-700 italic">
                                "If a broker gets paid $2,000 to sign a mortgage, and $0 if they reject it... and they don't have to deal with the default later... what do you think they will do?"
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: SECURITIZATION -->
    <section id="securitization" class="py-16 bg-[#F5F5F4]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="lg:text-center mb-10">
                <h2 class="text-base text-indigo-600 font-semibold tracking-wide uppercase">The Fuel</h2>
                <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl">
                    The Securitization Chain
                </p>
                <p class="mt-4 max-w-2xl text-xl text-stone-500 lg:mx-auto">
                    How does a bad loan in Florida poison a pension fund in Norway? It gets passed like a hot potato. Click the stages below to see the hidden incentives.
                </p>
            </div>

            <!-- CSS Grid Diagram (No SVG) -->
            <div class="mt-8 max-w-5xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4 items-center text-center">
                    
                    <!-- Node 1 -->
                    <div class="md:col-span-1 group cursor-pointer" onclick="showChainDetails('borrower')">
                        <div class="bg-white p-4 rounded-lg shadow border-2 border-transparent hover:border-indigo-500 transition h-32 flex flex-col justify-center items-center">
                            <div class="text-2xl mb-2">üè†</div>
                            <div class="font-bold text-stone-800 text-sm">Home Owner</div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="hidden md:flex md:col-span-1 justify-center items-center">
                        <div class="arrow-right"></div>
                    </div>
                    <div class="md:hidden flex justify-center py-2"><div class="arrow-down"></div></div>

                    <!-- Node 2 -->
                    <div class="md:col-span-1 group cursor-pointer" onclick="showChainDetails('broker')">
                        <div class="bg-white p-4 rounded-lg shadow border-2 border-transparent hover:border-indigo-500 transition h-32 flex flex-col justify-center items-center">
                            <div class="text-2xl mb-2">ü§ù</div>
                            <div class="font-bold text-stone-800 text-sm">Mortgage Broker</div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="hidden md:flex md:col-span-1 justify-center items-center">
                        <div class="arrow-right"></div>
                    </div>
                    <div class="md:hidden flex justify-center py-2"><div class="arrow-down"></div></div>

                    <!-- Node 3 -->
                    <div class="md:col-span-1 group cursor-pointer" onclick="showChainDetails('wallst')">
                        <div class="bg-white p-4 rounded-lg shadow border-2 border-transparent hover:border-indigo-500 transition h-32 flex flex-col justify-center items-center">
                            <div class="text-2xl mb-2">üè¶</div>
                            <div class="font-bold text-stone-800 text-sm">Wall St. Bank</div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="hidden md:flex md:col-span-1 justify-center items-center">
                        <div class="arrow-right"></div>
                    </div>
                    <div class="md:hidden flex justify-center py-2"><div class="arrow-down"></div></div>

                    <!-- Node 4 -->
                    <div class="md:col-span-1 group cursor-pointer" onclick="showChainDetails('investor')">
                        <div class="bg-white p-4 rounded-lg shadow border-2 border-transparent hover:border-indigo-500 transition h-32 flex flex-col justify-center items-center">
                            <div class="text-2xl mb-2">üíº</div>
                            <div class="font-bold text-stone-800 text-sm">Global Investor</div>
                        </div>
                    </div>
                </div>

                <!-- Detail Panel -->
                <div id="chain-detail-panel" class="mt-8 bg-white p-6 rounded-lg shadow-md border-t-4 border-indigo-600 min-h-[150px]">
                    <h4 id="chain-title" class="text-lg font-bold text-stone-900">Select a stage above to analyze the incentives.</h4>
                    <p id="chain-desc" class="mt-2 text-stone-600">The Securitization process turned individual mortgages into tradable bonds (MBS) and complex derivatives (CDOs).</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 3: THE MECHANISM (LEVERAGE) -->
    <section id="leverage" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div>
                    <h2 class="text-base text-indigo-600 font-semibold tracking-wide uppercase">The Mechanism</h2>
                    <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl">
                        The Mathematics of Leverage
                    </p>
                    <p class="mt-4 text-lg text-stone-500">
                        Banks weren't just buying bad loans; they were buying them with <strong>borrowed money</strong>.
                    </p>
                    <div class="mt-6 prose prose-stone">
                        <p>Investment banks like Lehman Brothers were leveraged approx <strong>33:1</strong>.</p>
                        <ul class="bg-indigo-50 p-4 rounded-md list-none space-y-2">
                            <li><strong>Assets:</strong> $33 Billion (Mortgages)</li>
                            <li><strong>Equity:</strong> $1 Billion (Actual Bank Money)</li>
                            <li><strong>Debt:</strong> $32 Billion (Borrowed)</li>
                        </ul>
                        <p class="font-bold text-stone-800 mt-4">Interactive Experiment:</p>
                        <p>Move the slider to drop the value of the Housing Assets. Watch how fast the Equity disappears.</p>
                        
                        <div class="mt-6">
                            <label for="marketDrop" class="block text-sm font-medium text-stone-700">Asset Value Drop: <span id="dropVal" class="font-bold text-red-600">0%</span></label>
                            <input type="range" id="marketDrop" min="0" max="10" step="0.5" value="0" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer mt-2">
                            <div class="flex justify-between text-xs text-stone-400 mt-1">
                                <span>0% (Stable)</span>
                                <span>3% (Danger)</span>
                                <span>10% (Crash)</span>
                            </div>
                        </div>

                        <div id="bankStatus" class="mt-4 p-3 bg-green-100 text-green-800 font-bold rounded text-center transition-colors">
                            Bank Status: SOLVENT
                        </div>
                    </div>
                </div>

                <div class="bg-stone-50 p-6 rounded-lg shadow-inner">
                    <h3 class="text-center font-bold text-stone-700 mb-2">Balance Sheet Impact</h3>
                    <div class="chart-container">
                        <canvas id="leverageChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-stone-400 mt-4">
                        Note: In a 33:1 leverage scenario, a mere ~3% drop in asset value wipes out 100% of equity.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 4: CONTAGION -->
    <section id="contagion" class="py-16 bg-[#F5F5F4]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="lg:text-center mb-10">
                <h2 class="text-base text-indigo-600 font-semibold tracking-wide uppercase">The Explosion</h2>
                <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-stone-900 sm:text-4xl">
                    Global Contagion
                </p>
                <p class="mt-4 max-w-2xl text-xl text-stone-500 lg:mx-auto">
                    When US housing prices fell (The Bubble Burst), the value of the assets held by global banks collapsed.
                </p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto">
                <div class="chart-container" style="max-width: 100%; height: 400px; max-height: 450px;">
                    <div id="contagionPlot" style="width: 100%; height: 100%;"></div>
                </div>
                <div class="mt-4 text-sm text-stone-500 text-center">
                    Comparison of the US Case-Shiller Home Price Index vs. European Banking Stocks Index (Normalized).
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 5: STRESS TEST -->
    <section id="stresstest" class="py-16 bg-stone-900 text-white">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-serif font-bold mb-6">Final Stress Test: The Moral Hazard</h2>
            <p class="text-xl text-stone-300 mb-8">
                It is September 2008. Lehman Brothers is insolvent. You are the Federal Reserve Chairman.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:border-indigo-500 transition cursor-pointer" onclick="makeDecision('bailout')">
                    <h3 class="text-xl font-bold text-indigo-400 mb-2">Option A: Bail Them Out</h3>
                    <p class="text-sm text-stone-400">Provide government funds to save the bank. Stabilize the market, but teach banks they can take risks without consequence.</p>
                </div>
                <div class="bg-stone-800 p-6 rounded-lg border border-stone-700 hover:border-red-500 transition cursor-pointer" onclick="makeDecision('fail')">
                    <h3 class="text-xl font-bold text-red-400 mb-2">Option B: Let Them Fail</h3>
                    <p class="text-sm text-stone-400">Refuse government aid. Uphold free market principles, but risk a total freeze of the global credit system.</p>
                </div>
            </div>

            <div id="decision-feedback" class="hidden p-6 rounded-lg bg-stone-800 border-l-4">
                <!-- Feedback injected by JS -->
            </div>
        </div>
    </section>

    <footer class="bg-stone-900 border-t border-stone-800 py-8 text-center text-stone-500 text-sm">
        <p>&copy; 2008 Financial Crisis Interactive Module. LSE Economics Simulation.</p>
    </footer>

    <!-- LOGIC START -->
    <script>
        // --- 1. UTILS: Label Wrapping ---
        function wrapLabel(str, maxLen = 16) {
            if (str.length <= maxLen) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= maxLen) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // --- 2. INCENTIVES CHART (Chart.js) ---
        const ctxIncentive = document.getElementById('incentiveChart').getContext('2d');
        const incentiveChart = new Chart(ctxIncentive, {
            type: 'bar',
            data: {
                labels: ['2001', '2002', '2003', '2004', '2005', '2006'],
                datasets: [
                    {
                        label: 'Subprime Volume ($Bn)',
                        data: [190, 230, 310, 540, 625, 600],
                        backgroundColor: '#4F46E5', // Indigo 600
                        yAxisID: 'y',
                        order: 2
                    },
                    {
                        label: 'Loan Quality (Documentation)',
                        data: [80, 75, 65, 50, 40, 30], // Inverted visual
                        borderColor: '#EF4444', // Red 500
                        backgroundColor: '#EF4444',
                        type: 'line',
                        borderWidth: 3,
                        pointRadius: 4,
                        yAxisID: 'y1',
                        order: 1,
                        hidden: true // Initially hidden for interaction
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    },
                    legend: { position: 'bottom' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'Volume ($ Billions)' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Quality Score (100=High)' }
                    }
                }
            }
        });

        document.getElementById('toggleQualityBtn').addEventListener('click', function() {
            const isHidden = incentiveChart.getDatasetMeta(1).hidden;
            incentiveChart.getDatasetMeta(1).hidden = isHidden === null ? !incentiveChart.data.datasets[1].hidden : !isHidden;
            incentiveChart.update();
            this.textContent = isHidden ? 'Hide "Quality Check" Line' : 'Show "Quality Check" Line';
        });

        // --- 3. SECURITIZATION INTERACTION ---
        const chainData = {
            'borrower': {
                title: "The Home Owner",
                desc: "INCENTIVE: Wanted the 'American Dream'. With rising house prices, they believed they could always refinance later. Low 'teaser rates' made expensive homes seem affordable."
            },
            'broker': {
                title: "The Mortgage Broker",
                desc: "INCENTIVE: Paid a fee per loan originated. Had zero liability if the borrower defaulted later. Incentivized to approve ANYONE, regardless of ability to pay."
            },
            'wallst': {
                title: "Wall Street Bank",
                desc: "INCENTIVE: Earned massive fees for packaging loans into bonds (MBS). Needed a constant supply of loans to feed the machine. Ignored risk to keep volume high."
            },
            'investor': {
                title: "Global Investor",
                desc: "INCENTIVE: Desperate for yield in a low-interest-rate environment. Trusted the 'Triple-A' ratings given to these bonds and didn't look at the toxic loans underneath."
            }
        };

        function showChainDetails(key) {
            const panel = document.getElementById('chain-detail-panel');
            const title = document.getElementById('chain-title');
            const desc = document.getElementById('chain-desc');
            
            panel.classList.remove('border-indigo-600', 'border-red-500', 'border-amber-500');
            
            // Animation reset
            panel.classList.remove('opacity-100');
            void panel.offsetWidth; // trigger reflow
            panel.classList.add('opacity-100', 'transition-opacity', 'duration-500');

            title.textContent = chainData[key].title;
            desc.textContent = chainData[key].desc;
            panel.classList.add('border-indigo-600');
        }

        // --- 4. LEVERAGE CALCULATOR (Chart.js) ---
        const ctxLeverage = document.getElementById('leverageChart').getContext('2d');
        const leverageChart = new Chart(ctxLeverage, {
            type: 'bar',
            data: {
                labels: ['Initial State', 'After Market Drop'],
                datasets: [
                    {
                        label: 'Debt (Liabilities)',
                        data: [32, 32],
                        backgroundColor: '#A8A29E', // Stone 400
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Equity (Capital)',
                        data: [1, 1], // Initial 1
                        backgroundColor: '#4F46E5', // Indigo 600
                        stack: 'Stack 0',
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                    },
                    y: {
                        stacked: true,
                        max: 35,
                        title: { display: true, text: 'Billions ($)' }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                }
            }
        });

        const dropSlider = document.getElementById('marketDrop');
        const dropLabel = document.getElementById('dropVal');
        const bankStatus = document.getElementById('bankStatus');

        dropSlider.addEventListener('input', function(e) {
            const dropPercent = parseFloat(e.target.value); // 0 to 10
            dropLabel.textContent = dropPercent + '%';

            // Math:
            // Initial Assets = 33. Debt = 32. Equity = 1.
            // New Assets = 33 * (1 - (dropPercent/100))
            // Debt stays 32.
            // New Equity = New Assets - Debt.
            
            const initialAssets = 33;
            const debt = 32;
            const newAssets = initialAssets * (1 - (dropPercent / 100));
            let newEquity = newAssets - debt;

            // Update Chart
            // We only update the second bar ('After Market Drop')
            // Dataset 0 is Debt (Always 32, technically, unless assets < debt then assets limit it visually, but for simplicity keep debt static)
            // Dataset 1 is Equity.
            
            leverageChart.data.datasets[1].data[1] = Math.max(0, newEquity); // Visual equity floor at 0
            
            // Visual feedback for insolvency
            if (newEquity < 0) {
                bankStatus.textContent = "Bank Status: INSOLVENT (Bankrupt)";
                bankStatus.className = "mt-4 p-3 bg-red-100 text-red-800 font-bold rounded text-center transition-colors";
                leverageChart.data.datasets[1].backgroundColor = ['#4F46E5', '#EF4444']; // Turn second bar red logic (needs array)
            } else {
                bankStatus.textContent = "Bank Status: SOLVENT";
                bankStatus.className = "mt-4 p-3 bg-green-100 text-green-800 font-bold rounded text-center transition-colors";
                leverageChart.data.datasets[1].backgroundColor = '#4F46E5';
            }
            
            leverageChart.update();
        });

        // --- 5. CONTAGION PLOT (Plotly.js) ---
        const years = [2006, 2006.5, 2007, 2007.5, 2008, 2008.5, 2009];
        // Normalized Data approx
        const usHousing = [100, 98, 92, 85, 75, 65, 60];
        const euBanks =   [100, 102, 98, 88, 55, 35, 30];

        const trace1 = {
            x: years,
            y: usHousing,
            mode: 'lines',
            name: 'US Housing Market',
            line: { color: '#4F46E5', width: 3 }
        };

        const trace2 = {
            x: years,
            y: euBanks,
            mode: 'lines',
            name: 'European Bank Stocks',
            line: { color: '#EF4444', width: 3, dash: 'dot' }
        };

        const layout = {
            margin: { t: 20, l: 40, r: 20, b: 40 },
            paper_bgcolor: '#FFFFFF',
            plot_bgcolor: '#FFFFFF',
            showlegend: true,
            legend: { x: 0.05, y: 0.1 },
            xaxis: { title: 'Year', tickvals: [2006, 2007, 2008, 2009] },
            yaxis: { title: 'Index Value (Start = 100)' },
            font: { family: 'Lato, sans-serif' }
        };

        Plotly.newPlot('contagionPlot', [trace1, trace2], layout, {responsive: true, displayModeBar: false});

        // --- 6. DECISION LOGIC ---
        function makeDecision(choice) {
            const feedback = document.getElementById('decision-feedback');
            feedback.classList.remove('hidden', 'border-indigo-500', 'border-red-500');
            
            if (choice === 'bailout') {
                feedback.classList.add('border-indigo-500');
                feedback.innerHTML = `
                    <h4 class="text-lg font-bold text-indigo-400">Result: Short-Term Stability</h4>
                    <p class="text-stone-300 mt-2">You saved the system today. The ATMs keep working. However, banks now believe they are "Too Big To Fail." They may take even bigger risks in the future, knowing the taxpayer will save them. This is called <strong>Moral Hazard</strong>.</p>
                `;
            } else {
                feedback.classList.add('border-red-500');
                feedback.innerHTML = `
                    <h4 class="text-lg font-bold text-red-400">Result: Immediate Catastrophe</h4>
                    <p class="text-stone-300 mt-2">You upheld the free market. However, Lehman was connected to everyone. Trust evaporates instantly. Global trade credit freezes. Payrolls fail. The "Great Recession" deepens significantly. History suggests this was the harder path.</p>
                `;
            }
        }
    </script>
</body>
</html>

```
